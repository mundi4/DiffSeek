<!DOCTYPE html>
<html>

<head>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    div {
      width: 100px;
      background-color: #eee;
      white-space: pre-wrap;
      position: relative;
    }

    br {
      position: relative;
    }

    /* div::after {
            position: absolute;
            top:0;
            left: 0;
            content: " ";
            white-space: pre;
            display: block;
            height: 40px;
            width: 400px;
            background-color: red;
        } */
    [data-line] {}

    a {
      position: relative;
    }

    a::after {
      position: absolute;
      top: 0;
      left: 0;
      content: " ";
      white-space: pre;
      display: block;
      height: 100%;
      width: 100px;
      background-color: rgba(255, 0, 0, 0.5);
    }

    div,
    p {
      min-height: 20px;
      height: 20px;
      ;
    }
  </style>

</head>

<body>

  <p> hello     
    <b>world</b>    
  </p>
  <p>world  

  </p>


  <script>function removeAttrs(node, allowedAttrs) {
  const attrs = [...node.attributes];
  for (const attr of attrs) {
    if (!allowedAttrs.has(attr.name)) {
      node.removeAttribute(attr.name);
    }
  }
  // 재귀: 자식도 처리
  for (const child of node.children) {
    removeAttrs(child, allowedAttrs);
  }
}

function createCleanNode(oldNode, allowedAttrs) {
  const newNode = document.createElement(oldNode.tagName);
  // 속성 복사
  for (const attr of oldNode.attributes) {
    if (allowedAttrs.has(attr.name)) {
      newNode.setAttribute(attr.name, attr.value);
    }
  }
  // 자식 복사 (재귀)
  for (const child of oldNode.children) {
    newNode.appendChild(createCleanNode(child, allowedAttrs));
  }
  // 텍스트 노드 복사 (간단하게)
  newNode.textContent = oldNode.textContent;
  return newNode;
}

// 테스트용
const allowedAttrs = new Set(['id', 'class']);

function buildTestNode() {
  const parent = document.createElement('div');
  parent.setAttribute('data-parent', 'pval');
  parent.setAttribute('id', 'keep-parent');

  const child1 = document.createElement('span');
  child1.setAttribute('data-child1', 'c1val');
  child1.setAttribute('class', 'keep-child1');
  child1.textContent = 'Child One';

  const child2 = document.createElement('p');
  child2.setAttribute('data-child2', 'c2val');
  child2.textContent = 'Child Two';

  parent.appendChild(child1);
  parent.appendChild(child2);

  return parent;
}

function testPerformance() {
  const testNode1 = buildTestNode();
  const testNode2 = buildTestNode();

  console.time('removeAttrs');
  removeAttrs(testNode1, allowedAttrs);
  console.timeEnd('removeAttrs');

  console.time('createCleanNode');
  const newNode = createCleanNode(testNode2, allowedAttrs);
  console.timeEnd('createCleanNode');

  console.log('After removeAttrs:', testNode1.outerHTML);
  console.log('After createCleanNode:', newNode.outerHTML);
}

testPerformance();
  </script>
</body>

</html>